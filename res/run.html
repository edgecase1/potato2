<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Run</title>
</head>
<body style="margin:0">
 <div id="terminalContainer" style="height:100vh; width:100%">
      <input id="commandInput" name="data" type="text" placeholder="type a command and press Enter" style="width:100%;padding:8px;font-family:monospace;margin-top:5px;" />
      <textarea readonly id="terminal" style="width:100%;height:100%;background:#111;color:#0f0;padding:10px;overflow-y:auto;font-family:monospace;border-radius:4px;"></textarea>
 </div>
</div>
  <script>
     const terminalContainer = document.getElementById('terminalContainer');
     const terminal = document.getElementById('terminal');
     const commandInput = document.getElementById('commandInput');

     commandInput.addEventListener('keydown', function (e) {
         if (e.key === 'Enter') {
             e.preventDefault();
             fetch('/api/run', { 
               method: 'POST',
               headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
               body: "command=" + commandInput.value
	     }).then(res => { 
                 console.log(res.status);
		 if(res.status == 403) {
	             console.log("forbidden")
	             window.location.replace("/login");
		 } else if(res.status == 200) {
                     console.log("command executed successfully");
                     return res.text();
		 } else {
	             console.error("undefined error")
		 }
	     }).then(text => {
                     return terminal.textContent = text;
             }).catch(err => {
                   console.error("error executing command");
	     });
	 }
    });

    window.onload = function recoverLastWindow() { 
         const window1 = localStorage.getItem('window');
         if(window1 == "command")
	 {
	     fetch('/api/status').then(() => {
                   console.log("command executed successfully");
               })
               .catch(err => {
                    window.location.replace("/login");
		    console.log("error executing command");
               });
	 }
    }
  </script>
</body>
</html>
